---

title: Clustering 


keywords: fastai
sidebar: home_sidebar



nb_path: "src/01_Clustering.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: src/01_Clustering.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clustering" class="doc_header"><code>clustering</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L363" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clustering</code>(<strong><code>t_next_level_2</code></strong>, <strong><code>level</code></strong>=<em><code>None</code></em>, <strong><code>algorithm</code></strong>=<em><code>'dbscan'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Function to get the clusters for single group by</p>
<p>:param t_next_level_2: Dictionary with the points to compute the
        cluster
:param level:  None Level to compute (Default None)</p>
<p>:param str algorithm : Algorithm type is supported (Default= 'dbscan')</p>
<p>:param int min_points_cluster:  minimun number of point to consider a cluster(Default 50)</p>
<p>:param double eps: Epsilon parameter In case is needed</p>
<p>:param bool return_noise: To return the noise (Default False)</p>
<p>:param bool verbose: Printing (Dafault False)</p>
<p>:returns list t_next_level_n: A list with dictionaries with the points, the parent, and nois</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="recursive_clustering" class="doc_header"><code>recursive_clustering</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L491" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>recursive_clustering</code>(<strong><code>this_level</code></strong>, <strong><code>to_process</code></strong>, <strong><code>cluster_tree</code></strong>, <strong><code>level</code></strong>=<em><code>0</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Performs the recursive clustering.
Calls compute_dbscan for each
list of clusters keepen the structure and then calls itself
until no more clusters satisfy the condition</p>
<p>:param dict this_level: level is the current level</p>
<p>:param int to_process: the max level to process</p>
<p>:param double eps: The epsilon parameter distance to pass to the needed algorithm</p>
<p>:param list cluster_tree : list of list to insert the levels</p>
<p>:param bool verbose : To print</p>
<p>:param double decay: In the use of dbscan the deacy parameter to reduce eps</p>
<p>:param int min_points_cluster: The min point for each cluster to pass to algorithm</p>
<p>:param str algorithm:  The string of the algorithm name to use</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="recursive_clustering_tree" class="doc_header"><code>recursive_clustering_tree</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L574" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>recursive_clustering_tree</code>(<strong><code>dic_points_ori</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Obtaing the recursive tree using a specific algorithm</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clustering-Algorithms">Clustering Algorithms<a class="anchor-link" href="#Clustering-Algorithms"> </a></h2><p>A wapper functions to obtain the clusterizations</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_dbscan" class="doc_header"><code>compute_dbscan</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L593" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_dbscan</code>(<strong><code>cluster</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Sklearn DBSCAN wrapper.</p>
<p>:param cluster: a (N,2) numpy array containing the obsevations</p>
<p>:returns list with numpy arrays for all the clusters obtained</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="adaptative_DBSCAN" class="doc_header"><code>adaptative_DBSCAN</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L641" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>adaptative_DBSCAN</code>(<strong><code>points2_clusters</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>The function use the knee and average to obtain a good value for epsilon and use
DBSCAN to obtain the clusters</p>
<p>:param list Points points2_clusters: Point to clusterize</p>
<p>:param int max_k: = (Default = len(points2_clusters)*.1)</p>
<p>:param int  min_k: (Default =50)</p>
<p>:param int step_k: (Default = 50)</p>
<p>:param int leaf_size: (Default = 50)</p>
<p>:param bool scale_points: (Default = True)</p>
<p>:param bool debugg: (Default = False)</p>
<p>:param bool ret_noise:  (Default = True)</p>
<p>:returns list : list of cluster. If ret_noise = True return tuple list of cluter and noise</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_hdbscan" class="doc_header"><code>compute_hdbscan</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L769" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_hdbscan</code>(<strong><code>points2_clusters</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>HDBSCAN wrapper.</p>
<p>:param np.array cluster: a (N,2) numpy array containing the obsevations</p>
<p>:returns:  list with numpy arrays for all the clusters obtained</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_OPTICS" class="doc_header"><code>compute_OPTICS</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L817" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_OPTICS</code>(<strong><code>points2_clusters</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>OPTICS wrapper.
:param np.array cluster: a (N,2) numpy array containing the obsevations
:returns:  list with numpy arrays for all the clusters obtained</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_Natural_cities" class="doc_header"><code>compute_Natural_cities</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L868" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_Natural_cities</code>(<strong><code>points2_clusters</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Compute Natural cities clustering</p>
<p>:param np.array points2_clusters: a (N,2) numpy array containing the obsevations</p>
<p>:returns: list with numpy arrays for all the clusters obtained</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_AMOEBA" class="doc_header"><code>compute_AMOEBA</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L930" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_AMOEBA</code>(<strong><code>points_array</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>The function obtains the AMOEBA algorithm on level basis</p>
<p>:param np.array points2_clusters: a (N,2) numpy array containing the obsevations</p>
<p>:returns: list with numpy arrays for all the clusters obtained</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Similarity-form-metric">Similarity form metric<a class="anchor-link" href="#Similarity-form-metric"> </a></h2><p>The function use the <em>Jaccar</em> index to and the points in the clusterization to obtain a metric tha is use to compare the clusters on level basis.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clustering-and-hieralchical-structure">Clustering and hieralchical structure<a class="anchor-link" href="#Clustering-and-hieralchical-structure"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_tree_clusterize_form" class="doc_header"><code>generate_tree_clusterize_form</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L1169" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_tree_clusterize_form</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Generates all the experiment all the experiment creates the data and clusterize using the algorithm available</p>
<p>:param levels_tree: Levels for the tree</p>
<p>:param int per_cluster: Points per clusters</p>
<p>:param levels_cluster:  Levels to clusterize</p>
<p>:param bool verbose:  To print some outputs</p>
<p>:returns: a dictionary with all the  data frames and a dictionary
with the similarity measurment created</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_tree_from_clustering" class="doc_header"><code>get_tree_from_clustering</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L1108" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_tree_from_clustering</code>(<strong><code>cluster_tree_clusters</code></strong>)</p>
</blockquote>
<p>Returns the tree from the iterative clustering, the cluster_tree_cluster</p>
<p>:param cluster_tree_clusters is a list of list with a dictionary that
       should contain the points of the next level clusters, the name of the parent
       cluster of such clusters (name of the current node), and the point that
       are consider noise.</p>
<p>:return A list of list that contains the nodes for each level of the tree.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="SSM" class="doc_header"><code>SSM</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L1040" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>SSM</code>(<strong><code>list_poly_c_1</code></strong>, <strong><code>list_poly_c_2</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>The function calculates the Similarity Form Measurment (SMF)
between two clusterizations</p>
<p>:param: list of nodes with points and polygons</p>
<p>:param: list of nodes with points and polygons</p>
<p>:param bool verbose: To print to debugg</p>
<p>:returns double: The similarity mesuarment</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Helper-functions">Helper functions<a class="anchor-link" href="#Helper-functions"> </a></h2><p>These functions are use by the clustering algorithms and to create the structure, mosly by handly the names for each node</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_alpha_shape" class="doc_header"><code>get_alpha_shape</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_alpha_shape</code>(<strong><code>point_list</code></strong>)</p>
</blockquote>
<p>Returns a polygon representing the hull of the points sample.</p>
<p>:param list point_list: list list of tuples with samples coordinates.</p>
<p>:returns shapely.Polygon: concave hull shapely polygon</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="set_colinear" class="doc_header"><code>set_colinear</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L81" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>set_colinear</code>(<strong><code>list_points</code></strong>)</p>
</blockquote>
<p>Check if in the list of points any of triplet of points
is colinear
:param list list_points: List of shapely Points</p>
<p>:returns bool: True if all are not colinear</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="collinear" class="doc_header"><code>collinear</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L96" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>collinear</code>(<strong><code>p1</code></strong>, <strong><code>p2</code></strong>, <strong><code>p3</code></strong>)</p>
</blockquote>
<p>Check if the points are colinear</p>
<p>:param shapely Point p1: point to chek if is colinear</p>
<p>:param shapely Point p2: point to chek if is colinear</p>
<p>:param shapely Point p3: point to chek if is colinear</p>
<p>:return bool: True if are colinear</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_segments" class="doc_header"><code>get_segments</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L112" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_segments</code>(<strong><code>points</code></strong>)</p>
</blockquote>
<p>Get the segments from a delaunay triangulation</p>
<p>:param points: Point to get Delaunay triangulation and exctract points</p>
<p>:return edges:</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_polygons_buf" class="doc_header"><code>get_polygons_buf</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L134" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_polygons_buf</code>(<strong><code>lines</code></strong>)</p>
</blockquote>
<p>Obtain the poligons from the lines</p>
<p>:param list lines: List of lines</p>
<p>:returns shapely polygon: the union of the union of
edges (Polygon or multypolygon)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="labels_filtra" class="doc_header"><code>labels_filtra</code><a href="https://github.com/CentroGeo/HierarchicalGeoClustering/tree/master/HierarchicalGeoClustering/Clustering.py#L152" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>labels_filtra</code>(<strong><code>point_points</code></strong>, <strong><code>multy_pol</code></strong>)</p>
</blockquote>
<p>Labels the points in the multy_pol if no polygon contains
a point is label as -1</p>
<p>:param shapely MultyPoint point_points: Points to check</p>
<p>:param multy_pol</p>
<p>:returns np.array: Label array with -1 if is not contained
in a polygon</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

